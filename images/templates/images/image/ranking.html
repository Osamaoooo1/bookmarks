{% extends "base.html" %}
{% block title %}Images ranking{% endblock %}
{% block content %}
 <div class="d-flex align-items-center justify-content-between mb-4">
  <h1 class="h4 mb-0">
   <i class="fas fa-fire text-danger me-2"></i>Images ranking
  </h1>
 </div>

 {% if most_viewed %}
  <div class="card border-0 shadow-sm mb-4">
   <div class="card-body p-0">
    {% for image in most_viewed %}
     <div class="border-bottom p-3">
      <div class="row align-items-center">
       <!-- Rank Badge -->
       <div class="col-auto">
        {% if forloop.counter == 1 %}
         <div class="bg-warning rounded-circle d-flex align-items-center justify-content-center" style="width: 50px; height: 50px;">
          <i class="fas fa-crown text-white fs-4"></i>
         </div>
        {% elif forloop.counter == 2 %}
         <div class="bg-secondary rounded-circle d-flex align-items-center justify-content-center" style="width: 50px; height: 50px;">
          <span class="text-white fw-bold fs-5">2</span>
         </div>
        {% elif forloop.counter == 3 %}
         <div class="bg-danger rounded-circle d-flex align-items-center justify-content-center" style="width: 50px; height: 50px;">
          <span class="text-white fw-bold fs-5">3</span>
         </div>
        {% else %}
         <div class="bg-light rounded-circle d-flex align-items-center justify-content-center" style="width: 50px; height: 50px;">
          <span class="text-muted fw-bold">{{ forloop.counter }}</span>
         </div>
        {% endif %}
       </div>
       
       <!-- Image Thumbnail -->
       <div class="col-auto">
        <a href="{{ image.get_absolute_url }}" class="text-decoration-none">
         {% load thumbnail %}
         {% thumbnail image.image 80x80 crop="smart" as im %}
          <img src="{{ im.url }}" class="rounded" alt="{{ image.title }}" style="width: 80px; height: 80px; object-fit: cover;">
        </a>
       </div>
       
       <!-- Image Info -->
       <div class="col">
        <h6 class="mb-1">
         <a href="{{ image.get_absolute_url }}" class="text-decoration-none text-dark">
          {{ image.title }}
         </a>
        </h6>
        <div class="d-flex align-items-center gap-3 mb-2">
         <small class="text-muted">
          <i class="fas fa-user me-1"></i>
          {{ image.user.get_full_name|default:image.user.username }}
         </small>
         <small class="text-muted">
          <i class="fas fa-calendar me-1"></i>
          {{ image.created|date:"M d, Y" }}
         </small>
        </div>
        {% if image.description %}
         <p class="text-muted small mb-0">{{ image.description|truncatewords:15 }}</p>
        {% endif %}
       </div>
       
       <!-- Stats -->
       <div class="col-auto text-end">
        <div class="d-flex flex-column gap-2">
         <span class="badge bg-danger">
          <i class="fas fa-heart me-1"></i>
          {{ image.total_likes }} like{{ image.total_likes|pluralize }}
         </span>
         <span class="badge bg-primary">
          <i class="fas fa-eye me-1"></i>
          Most viewed
         </span>
        </div>
       </div>
      </div>
     </div>
    {% endfor %}
   </div>
  </div>
  
  <!-- View All Images Link -->
  <div class="text-center">
   <a href="{% url 'images:list' %}" class="btn btn-outline-primary">
    <i class="fas fa-images me-2"></i>View all images
   </a>
  </div>
  
 {% else %}
  <div class="card border-0 shadow-sm">
   <div class="card-body text-center py-5">
    <i class="fas fa-chart-line fa-4x text-muted mb-3"></i>
    <h5 class="text-muted">No ranking data yet</h5>
    <p class="text-muted mb-0">Images need to be viewed before they can appear in rankings.</p>
   </div>
  </div>
 {% endif %}
{% endblock %}